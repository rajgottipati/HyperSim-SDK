{"extracted_information": "Discord's WebSocket architecture uses a 'gateway' service for real-time updates. Traffic optimization primarily involved migrating from zlib to zstandard for WebSocket compression, with significant gains from streaming zstandard. Further bandwidth reduction was achieved by optimizing 'Passive Sessions' data transfer. Real-time scaling faced challenges with long-lived connections, leading to custom solutions like a feedback loop for buffer upgrades (later discarded) and delta-based updates for passive sessions. Connection management involves client-side bindings and a phased rollout strategy.", "specifications": {"websocket_gateway": {"service_name": "gateway", "purpose": "delivers real-time updates to clients", "backend_language": "Elixir", "compression_algorithms": [{"name": "zlib", "usage_period": "since late 2017", "compression_ratio": "2 to 10 times smaller messages", "implementation": "streaming compression (stream spun up on connection, exists until websocket closed)"}, {"name": "zstandard", "status": "implemented", "initial_assessment": "higher compression ratios, shorter compression times, supports dictionaries (initially performed worse than zlib without streaming)", "streaming_implementation": {"status": "successfully implemented", "elixir_binding": "ezstd (forked for streaming support, contributed upstream)", "performance_vs_zlib_streaming": "significantly outperforms zlib in time to compress and compression ratio", "message_create_payload_size_comparison": {"zlib_streaming": "~250 bytes", "zstandard_streaming": "166 bytes", "original_zstandard_non_streaming": ">750 bytes"}, "message_create_compression_time_per_byte": {"zlib_streaming": "~100 microseconds", "zstandard_streaming": "45 microseconds"}}, "tuning_parameters": {"overall_compression_level": 6, "chainlog": 16, "hashlog": 16, "windowlog": 18}, "dictionary_support_experiment": {"status": "discarded due to minimal gains vs. complexity", "generation_method": "zstd --train from 120,000 anonymized messages (JSON and ETF)", "ready_payload_compression_gains": {"size_uncompressed": "2,517,725 bytes", "size_zstandard_default": "306,745 bytes", "size_zstandard_with_dictionary": "306,098 bytes", "gain": "~600 bytes"}, "typing_start_payload_compression_gains": {"size_uncompressed": "636 bytes", "size_zstandard_without_dictionary": "466 bytes", "size_zstandard_with_dictionary": "187 bytes"}, "message_create_payload_size_with_dictionary": "slightly larger than zstandard streaming without dictionary"}}]}, "client_implementations": {"Android": "Java (zstd-jni)", "iOS": "Objective C (custom bindings developed)", "Desktop": "Rust (zstd-safe)"}, "passive_sessions_v2_dispatch_type": "delta-based updates", "gateway_process_memory_usage": {"zstandard_streaming_context_implementation": "C using NIF (Native Implemented Function)", "memory_allocation_issues": "BEAM driver_alloc fragmentation"}}, "features": ["Real-time updates via 'gateway' service", "WebSocket compression (initially zlib, migrated to zstandard streaming)", "Adaptive zstandard compression tuning (chainlog, hashlog, windowlog)", "Passive Sessions (V1: full snapshots, V2: delta-based updates)", "Phased rollout strategy for critical changes"], "statistics": {"overall_bandwidth_reduction": "almost 40%", "zstandard_streaming_rollout_date": "April 2024", "passive_sessions_v2_rollout_date": "late May 2024", "passive_update_v1_traffic_share": {"percentage_of_gateway_traffic": "over 30%", "percentage_of_dispatches_sent": "around 2%"}, "passive_update_v2_traffic_share": {"new_percentage_of_gateway_traffic": "5%", "cluster_wide_reduction_from_passive_sessions": "20%"}, "buffer_upgrading_experiment_results": {"achieved_upgrade_ratio": "up to 30%", "anticipated_upgrade_ratio": "around 70%"}}, "temporal_info": {"zlib_compression_start": "late 2017", "zstandard_first_attempt_date": "2019", "current_zstandard_experiment_period": "over the last six months (relative to article publish date)", "zstandard_rollout": "over the course of a few months", "gateway_bandwidth_chart_period": "January 2024 to August 12, 2024"}, "geographical_data": {}, "references": []}